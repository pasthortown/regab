!function(){function e(e,a,t,o,i){var n=e(i.API_URL+i.LOGIN_URL,{},{login:{method:"POST",isArray:!1},register:{method:"POST",url:i.API_URL+i.USERS_URL},change_password:{method:"POST",url:i.API_URL+i.CHANGEPASS_URL},usuarios:{method:"GET",url:i.API_URL+i.USERS_URL,isArray:!0}}),r={};r.init=function(){r.isLoggedIn()&&(a.user=r.currentUser())};var s=function(e){if(e){t.token=e;var o=e.split(".");o.length>1&&(t.user=JSON.parse(atob(o[1])),a.user=t.user)}};r.login=function(e,a){return o(function(t,o){n.login({_username:e,_password:a}).$promise.then(function(e){s(e.token),t()},function(){o()})})},r.getUsers=function(){return o(function(e,a){n.usuarios().$promise.then(function(a){e(a)},function(e){a(e)})})},r.register=function(e){return o(function(a,t){n.register({_name:e.name,_email:e.email,_cargo:e.cargo,_password:e.password,_roles:e.roles}).$promise.then(function(e){a({id:e.data.id,name:e.data.name,roles:e.data.roles,email:e.data.email,cargo:e.data.cargo,created_at:e.data.created_at,updated_at:e.data.updated_at})},function(){t()})})},r.changePassword=function(e,a){return o(function(t,o){n.change_password({_oldpass:e,_newpass:a}).$promise.then(function(e){t(e)},function(){o()})})},r.logout=function(){delete t.user,delete a.user,delete t.token,delete a.token},r.checkPermissionForView=function(e){return!e.requiresAuthentication||c(e)};var c=function(e){return!!r.isLoggedIn()&&(!e.permissions||!e.permissions.length||r.userHasPermission(e.permissions))};r.userHasPermission=function(e){if(!r.isLoggedIn())return!1;var a=!1;return angular.forEach(e,function(e,o){if(t.user.roles.indexOf(e)>=0)return void(a=!0)}),a},r.currentUser=function(){return t.user},r.isLoggedIn=function(){return null!=t.user},r.wrapActions=function(e,a){for(var t=e,o=0;o<a.length;o++)u(t,a[o]);return t};var u=function(e,a){e["_"+a]=e[a],e[a]=function(o,i,n){return e["_"+a](angular.extend({},o||{},{access_token:t.token}),i,n)}};return n=r.wrapActions(n,["register","change_password","usuarios"]),r}function a(e,a,t){var o=e(a.API_URL+a.CATALOGO_URL,{},{actividades:{method:"GET",url:a.API_URL+a.CATALOGO_URL+"/actividades"},clasificaciones:{method:"GET",url:a.API_URL+a.CATALOGO_URL+"/clasificaciones"},categorias:{method:"GET",url:a.API_URL+a.CATALOGO_URL+"/categorias"},provincias:{method:"GET",url:a.API_URL+a.CATALOGO_URL+"/provincias"},cantones:{method:"GET",url:a.API_URL+a.CATALOGO_URL+"/cantones"},parroquias:{method:"GET",url:a.API_URL+a.CATALOGO_URL+"/parroquias"},activos_fijos_items:{method:"GET",url:a.API_URL+a.CATALOGO_URL+"/activos_fijos_items"},certificados:{method:"GET",url:a.API_URL+a.CATALOGO_URL+"/certificados"},categoria_certificados:{method:"GET",url:a.API_URL+a.CATALOGO_URL+"/categoria_certificados"}});return o=t.wrapActions(o,["actividades","clasificaciones","categorias","activos_fijos_items","provincias","cantones","parroquias","certificados","categoria_certificados"])}function t(e,a,t){var o=e(a.API_URL+a.ESTABLECIMIENTO_URL+"/:id",{id:"@id"},{update:{method:"PUT"},get_by_usuario:{method:"GET",url:a.API_URL+a.ESTABLECIMIENTO_URL+"/get_by_usuario"}});return o=t.wrapActions(o,["query","update","save","get","remove","delete","get_by_usuario"])}function o(e,a,t){var o=e(a.API_URL+a.USERS_URL,{id:"@id"},{change_password:{method:"POST",url:a.API_URL+a.CHANGEPASS_URL}});return o=t.wrapActions(o,["query","update","save","get","remove","delete","change_password"])}angular.module("boilerplate").factory("Catalogo",a).factory("Usuario",o).factory("Establecimiento",t).factory("Auth",e),e.$inject=["$resource","$rootScope","$sessionStorage","$q","CONSTANTS"],a.$inject=["$resource","CONSTANTS","Auth"],t.$inject=["$resource","CONSTANTS","Auth"],o.$inject=["$resource","CONSTANTS","Auth"]}(),function(){function e(e,a,t){e.email="",e.password="",e.failed=!1,e.login=function(){t.login(e.email,e.password).then(function(){a.path("/home")},function(){e.failed=!0})}}function a(e,a,t,o){e.user=a.currentUser(),e.idEst=t.id,e.establecimientos=[];var i=new o;i.$get_by_usuario(function(a){e.establecimientos=a.data})}function t(e,a,t){var o=new t;o.$get(function(a){e.usuarios=a.data})}function o(e,a,t,o){e.nuevo=new o,e.nuevo._roles=["ROLE_USER"],e.onGuardar=function(){e.nuevo.$save(function(e){t.path("/usuarios")},function(e){alert("Ocurrio un error al crear el usuario")})}}function i(e,a,t){e.oldpass="",e.newpass="",e.onUpdatePassword=function(){a.changePassword(e.oldpass,e.newpass).then(function(a){e.newpass="",alert("Contrase&ntilde;a Actualizada"),t.path("/home")},function(){alert("Error al actualizar contrase&ntilde;a")})}}function n(e,a,t,o,i,n){e.user=o.currentUser();var r=a.id;e.clasificaciones=[],e.categorias=[],e.provincias=[],e.cantones=[],e.parroquias=[],e.categoriasCertificados=[],e.certificados=[],e.idiomas=[{name:"EspaÃ±ol",sigla:"es"},{name:"Ingles",sigla:"en"},{name:"Ruso",sigla:"ru"},{name:"Aleman",sigla:"de"},{name:"Chino",sigla:"zh"},{name:"Hindi",sigla:"hi"},{name:"Frances",sigla:"fr"},{name:"Portugues",sigla:"pt"},{name:"Italiano",sigla:"it"}],e.mapa={markers:{punto:{lat:-1.15,lng:-78.47,message:"Ubicacion del establecimiento, puede moverme si lo desea.",focus:!0,draggable:!0}},ecuadorCenter:{lat:-1.15,lng:-78.47,zoom:7},defaults:{scrollWheelZoom:!1},events:{}},e.$on("leafletDirectiveMap.dragend",function(a,t){e.est.latitud=t.model.lat,e.est.latitud=t.model.lng,console.log(t)}),e.activos_fijos_items=[];var s=new Date;r?(e.creating=!1,e.est=new i,i.get({id:r},function(a){e.est=new i,angular.extend(e.est,a.data);var t=[];angular.isDefined(e.est.idiomas)&&(t=e.est.idiomas.split(",")),e.est.idiomas=[];for(var o=0;o<t.length;o++)for(var n=0;n<e.idiomas.length;n++)t[o]==e.idiomas[n].sigla&&e.est.idiomas.push(angular.copy(e.idiomas[n]));e.est.anio_declaracion=a.anio_declaracion,e.activos_fijos_items=a.activos_fijos_items,c(),e.onDeclaracionChange(),e.selectedProvincia=e.est.parroquia.canton.provincia,e.selectedCanton=e.est.parroquia.canton,e.onProviniciaChange(),e.onCantonChange(),e.selectedClasificacion=e.est.categoria.clasificacion,e.onClasificacionChange()},function(e){alert("Ocurrio un error al buscar el establecimiento.")})):(e.creating=!0,e.est=new i),e.est.anio_declaracion=s.getFullYear(),e.est.tipo_contribuyente=1,e.est.obligado_contabilidad=!1,e.est.tipo_establecimiento=1,e.est.local=1,e.est.activos_fijos_items=[],e.est.total_activos_fijos=0,e.est.certificados=[],e.est.idiomas=[],e.est.estacionamientos=0,e.est.mujeres_total=0,e.est.hombres_total=0,e.est.mujeres_titulo_profesional=0,e.est.hombres_titulo_profesional=0,e.est.mujeres_idioma_extranjero=0,e.est.hombres_idioma_extranjero=0,e.est.mujeres_extranjeros=0,e.est.hombres_extranjeros=0,e.est.mujeres_discapacidad_fisica=0,e.est.hombres_discapacidad_fisica=0,e.est.mujeres_discapacidad_sensorial=0,e.est.hombres_discapacidad_sensorial=0,e.est.mujeres_discapacidad_intelectual=0,e.est.hombres_discapacidad_intelectual=0,e.total_mesas=0,e.total_plazas=0,n.clasificaciones({actividad:1}).$promise.then(function(a){e.clasificaciones=a.data},function(e){alert("Ocurrio un error al obtener las clasificaciones. Por favor recargue la pagina nuevamente.")}),n.provincias().$promise.then(function(a){e.provincias=a.data},function(e){alert("Ocurrio un error al obtener las provincias. Por favor recargue la pagina nuevamente.")}),n.activos_fijos_items().$promise.then(function(a){e.activos_fijos_items=a.data,c()},function(e){alert("Ocurrio un error al obtener los activos fijos. Por favor recargue la pagina nuevamente.")}),n.categoria_certificados().$promise.then(function(a){e.categoriasCertificados=a.data},function(e){alert("Ocurrio un error al obtener las categorias de certificados. Por favor recargue la pagina nuevamente.")}),e.selectedCert=null,e.selectedCatCert=null,e.onCategoriaCertificadoChange=function(){n.certificados({categoria:e.selectedCatCert.id}).$promise.then(function(a){e.certificados=a.data},function(e){alert("Ocurrio un error al obtener los tipos de certificados. Por favor recargue la pagina nuevamente.")})},e.selectedClasificacion=null,e.onClasificacionChange=function(){n.categorias({clasificacion:e.selectedClasificacion.id}).$promise.then(function(a){e.categorias=a.data},function(){alert("Ocurrio un error al obtener las categorias. Por favor recargue la pagina nuevamente.")})},e.selectedProvincia=null,e.onProviniciaChange=function(){n.cantones({provincia:e.selectedProvincia.id}).$promise.then(function(a){e.cantones=a.data},function(){alert("Ocurrio un error al obtener los cantones. Por favor recargue la pagina nuevamente.")})},e.selectedCanton=null,e.onCantonChange=function(){n.parroquias({canton:e.selectedCanton.id}).$promise.then(function(a){e.parroquias=a.data},function(){alert("Ocurrio un error al obtener las parroquias. Por favor recargue la pagina nuevamente.")})};var c=function(){e.est.activos_fijos_items=e.activos_fijos_items.filter(function(a){return angular.isUndefined(a.valor)&&(a.valor=0),parseInt(a.tipo_persona)==parseInt(e.est.tipo_contribuyente)}),e.est.activos_fijos_items.sort(function(e,a){return parseInt(e.orden)-parseInt(a.orden)})};e.onTipoContribuyenteChange=function(){c()},e.onDeclaracionChange=function(){e.est.total_activos_fijos=0,e.est.activos_fijos_items.forEach(function(a){"+"==a.operando?e.est.total_activos_fijos+=a.valor:e.est.total_activos_fijos-=a.valor})},e.onAddCertificado=function(){var a=e.est.certificados.some(function(a){return a.id==e.selectedCert.id});a||(e.est.certificados.push(angular.copy(e.selectedCert)),e.selectedCert=null)},e.onRemoveCertificado=function(a){e.est.certificados=e.est.certificados.filter(function(e){return e.id!=a.id})},e.onGuardar=function(){e.est.$save(function(e){200==e.code?t.path("/home/"+e.data.id):alert("ocurrio un error al guardar, vuelva a intentarlo")},function(e){alert("Ocurrio un error al guardar el establecimiento. Por favor recargue la pagina, e intentelo nuevamente.")})}}function r(e,a){e.isLoggedIn()&&e.logout(),a.path("/")}angular.module("boilerplate").controller("LoginCtrl",e).controller("HomeCtrl",a).controller("EstCtrl",n).controller("UsersCtrl",t).controller("RegisterCtrl",o).controller("PassCtrl",i).controller("LogoutCtrl",r),e.$inject=["$scope","$location","Auth"],a.$inject=["$scope","Auth","$routeParams","Establecimiento"],t.$inject=["$scope","Auth","Usuario"],o.$inject=["$scope","Auth","$location","Usuario"],i.$inject=["$scope","Auth","$location"],n.$inject=["$scope","$routeParams","$location","Auth","Establecimiento","Catalogo"],r.$inject=["Auth","$location"]}();
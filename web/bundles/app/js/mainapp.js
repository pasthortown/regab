!function(){function e(e,t,a,o,r){var i=e(r.API_URL+r.LOGIN_URL,{},{login:{method:"POST",isArray:!1},register:{method:"POST",url:r.API_URL+r.USERS_URL},change_password:{method:"POST",url:r.API_URL+r.CHANGEPASS_URL},usuarios:{method:"GET",url:r.API_URL+r.USERS_URL,isArray:!0}}),n={};n.init=function(){n.isLoggedIn()&&(t.user=n.currentUser())};var s=function(e){if(e){a.token=e;var o=e.split(".");o.length>1&&(a.user=JSON.parse(atob(o[1])),t.user=a.user)}};n.login=function(e,t){return o(function(a,o){i.login({_username:e,_password:t}).$promise.then(function(e){s(e.token),a()},function(){o()})})},n.getUsers=function(){return o(function(e,t){i.usuarios().$promise.then(function(t){e(t)},function(e){t(e)})})},n.register=function(e){return o(function(t,a){i.register({_name:e.name,_email:e.email,_cargo:e.cargo,_password:e.password,_roles:e.roles}).$promise.then(function(e){t({id:e.data.id,name:e.data.name,roles:e.data.roles,email:e.data.email,cargo:e.data.cargo,created_at:e.data.created_at,updated_at:e.data.updated_at})},function(){a()})})},n.changePassword=function(e,t){return o(function(a,o){i.change_password({_oldpass:e,_newpass:t}).$promise.then(function(e){a(e)},function(){o()})})},n.logout=function(){delete a.user,delete t.user,delete a.token,delete t.token},n.checkPermissionForView=function(e){return!e.requiresAuthentication||c(e)};var c=function(e){return!!n.isLoggedIn()&&(!e.permissions||!e.permissions.length||n.userHasPermission(e.permissions))};n.userHasPermission=function(e){if(!n.isLoggedIn())return!1;var t=!1;return angular.forEach(e,function(e,o){if(a.user.roles.indexOf(e)>=0)return void(t=!0)}),t},n.currentUser=function(){return a.user},n.isLoggedIn=function(){return null!=a.user},n.wrapActions=function(e,t){for(var a=e,o=0;o<t.length;o++)u(a,t[o]);return a};var u=function(e,t){e["_"+t]=e[t],e[t]=function(o,r,i){return e["_"+t](angular.extend({},o||{},{access_token:a.token}),r,i)}};return i=n.wrapActions(i,["register","change_password","usuarios"]),n}function t(e,t,a){var o=e(t.API_URL+t.CATALOGO_URL,{},{actividades:{method:"GET",url:t.API_URL+t.CATALOGO_URL+"/actividades"},clasificaciones:{method:"GET",url:t.API_URL+t.CATALOGO_URL+"/clasificaciones"},categorias:{method:"GET",url:t.API_URL+t.CATALOGO_URL+"/categorias"},provincias:{method:"GET",url:t.API_URL+t.CATALOGO_URL+"/provincias"},cantones:{method:"GET",url:t.API_URL+t.CATALOGO_URL+"/cantones"},parroquias:{method:"GET",url:t.API_URL+t.CATALOGO_URL+"/parroquias"},activos_fijos_items:{method:"GET",url:t.API_URL+t.CATALOGO_URL+"/activos_fijos_items"},certificados:{method:"GET",url:t.API_URL+t.CATALOGO_URL+"/certificados"},categoria_certificados:{method:"GET",url:t.API_URL+t.CATALOGO_URL+"/categoria_certificados"}});return o=a.wrapActions(o,["actividades","clasificaciones","categorias","activos_fijos_items","provincias","cantones","parroquias","certificados","categoria_certificados"])}function a(e,t,a){var o=e(t.API_URL+t.ESTABLECIMIENTO_URL+"/:id",{id:"@id"},{update:{method:"PUT"},get_by_usuario:{method:"GET",url:t.API_URL+t.ESTABLECIMIENTO_URL+"/get_by_usuario"}});return o=a.wrapActions(o,["query","update","save","get","remove","delete","get_by_usuario"])}function o(e,t,a){var o=e(t.API_URL+t.USERS_URL,{id:"@id"},{change_password:{method:"POST",url:t.API_URL+t.CHANGEPASS_URL}});return o=a.wrapActions(o,["query","update","save","get","remove","delete","change_password"])}angular.module("boilerplate").factory("Catalogo",t).factory("Usuario",o).factory("Establecimiento",a).factory("Auth",e),e.$inject=["$resource","$rootScope","$sessionStorage","$q","CONSTANTS"],t.$inject=["$resource","CONSTANTS","Auth"],a.$inject=["$resource","CONSTANTS","Auth"],o.$inject=["$resource","CONSTANTS","Auth"]}(),function(){function e(e,t,a){e.email="",e.password="",e.failed=!1,e.login=function(){a.login(e.email,e.password).then(function(){t.path("/home")},function(){e.failed=!0})}}function t(e,t,a,o){e.user=t.currentUser(),e.idEst=a.id,e.establecimientos=[];var r=new o;r.$get_by_usuario(function(t){e.establecimientos=t.data})}function a(e,t,a){var o=new a;o.$get(function(t){e.usuarios=t.data})}function o(e,t,a,o){e.list=[],e.sortingOrder="id",e.reverse=!1,e.filteredItems=[],e.groupedItems=[],e.itemsPerPage=30,e.pagedItems=[],e.currentPage=0;var r=function(e,t){return!t||e.toLowerCase().indexOf(t.toLowerCase())!==-1};e.search=function(){e.filteredItems=t("filter")(e.list,function(t){for(var a in t)if(r(t[a],e.query))return!0;return!1}),""!==e.sortingOrder&&(e.filteredItems=t("orderBy")(e.filteredItems,e.sortingOrder,e.reverse)),e.currentPage=0,e.groupToPages()},e.groupToPages=function(){e.pagedItems=[];for(var t=0;t<e.filteredItems.length;t++)t%e.itemsPerPage===0?e.pagedItems[Math.floor(t/e.itemsPerPage)]=[e.filteredItems[t]]:e.pagedItems[Math.floor(t/e.itemsPerPage)].push(e.filteredItems[t])},e.range=function(e,t){var a=[];t||(t=e,e=0);for(var o=e;o<t;o++)a.push(o);return a},e.prevPage=function(){e.currentPage>0&&e.currentPage--},e.nextPage=function(){e.currentPage<e.pagedItems.length-1&&e.currentPage++},e.setPage=function(){e.currentPage=this.n},e.sort_by=function(t){e.sortingOrder==t&&(e.reverse=!e.reverse),e.sortingOrder=t,$("th i").each(function(){$(this).removeClass().addClass("icon-sort")}),e.reverse?$("th."+new_sorting_order+" i").removeClass().addClass("icon-chevron-up"):$("th."+new_sorting_order+" i").removeClass().addClass("icon-chevron-down")};var i=new o;i.$get(function(t){e.list=t.data,e.search()})}function r(e,t,a,o){e.nuevo=new o,e.nuevo._roles=["ROLE_USER"],e.onGuardar=function(){e.nuevo.$save(function(e){a.path("/usuarios")},function(e){alert("Ocurrio un error al crear el usuario")})}}function i(e,t,a){e.oldpass="",e.newpass="",e.onUpdatePassword=function(){t.changePassword(e.oldpass,e.newpass).then(function(t){e.newpass="",alert("Contrase&ntilde;a Actualizada"),a.path("/home")},function(){alert("Error al actualizar contrase&ntilde;a")})}}function n(e,t,a,o,r,i){e.user=o.currentUser();var n=t.id;e.clasificaciones=[],e.categorias=[],e.provincias=[],e.cantones=[],e.parroquias=[],e.categoriasCertificados=[],e.certificados=[],e.idiomas=[{name:"EspaÃ±ol",sigla:"es"},{name:"Ingles",sigla:"en"},{name:"Ruso",sigla:"ru"},{name:"Aleman",sigla:"de"},{name:"Chino",sigla:"zh"},{name:"Hindi",sigla:"hi"},{name:"Frances",sigla:"fr"},{name:"Portugues",sigla:"pt"},{name:"Italiano",sigla:"it"}],e.mapa={markers:{punto:{lat:-1.15,lng:-78.47,message:"Ubicacion del establecimiento, puede moverme si lo desea.",focus:!0,draggable:!0}},ecuadorCenter:{lat:-1.15,lng:-78.47,zoom:7},defaults:{scrollWheelZoom:!1},events:{}},e.$on("leafletDirectiveMap.dragend",function(t,a){e.est.latitud=a.model.lat,e.est.latitud=a.model.lng,console.log(a)}),e.activos_fijos_items=[];var s=new Date;n?(e.creating=!1,e.est=new r,r.get({id:n},function(t){e.est=new r,angular.extend(e.est,t.data);var a=[];angular.isDefined(e.est.idiomas)&&(a=e.est.idiomas.split(",")),e.est.idiomas=[];for(var o=0;o<a.length;o++)for(var i=0;i<e.idiomas.length;i++)a[o]==e.idiomas[i].sigla&&e.est.idiomas.push(angular.copy(e.idiomas[i]));e.est.anio_declaracion=t.anio_declaracion,e.activos_fijos_items=t.activos_fijos_items,c(),e.onDeclaracionChange(),e.selectedProvincia=e.est.parroquia.canton.provincia,e.selectedCanton=e.est.parroquia.canton,e.onProviniciaChange(),e.onCantonChange(),e.selectedClasificacion=e.est.categoria.clasificacion,e.onClasificacionChange()},function(e){alert("Ocurrio un error al buscar el establecimiento.")})):(e.creating=!0,e.est=new r),e.est.anio_declaracion=s.getFullYear(),e.est.tipo_contribuyente=1,e.est.obligado_contabilidad=!1,e.est.tipo_establecimiento=1,e.est.local=1,e.est.activos_fijos_items=[],e.est.total_activos_fijos=0,e.est.certificados=[],e.est.idiomas=[],e.est.estacionamientos=0,e.est.mujeres_total=0,e.est.hombres_total=0,e.est.mujeres_titulo_profesional=0,e.est.hombres_titulo_profesional=0,e.est.mujeres_idioma_extranjero=0,e.est.hombres_idioma_extranjero=0,e.est.mujeres_extranjeros=0,e.est.hombres_extranjeros=0,e.est.mujeres_discapacidad_fisica=0,e.est.hombres_discapacidad_fisica=0,e.est.mujeres_discapacidad_sensorial=0,e.est.hombres_discapacidad_sensorial=0,e.est.mujeres_discapacidad_intelectual=0,e.est.hombres_discapacidad_intelectual=0,e.total_mesas=0,e.total_plazas=0,i.clasificaciones({actividad:1}).$promise.then(function(t){e.clasificaciones=t.data},function(e){alert("Ocurrio un error al obtener las clasificaciones. Por favor recargue la pagina nuevamente.")}),i.provincias().$promise.then(function(t){e.provincias=t.data},function(e){alert("Ocurrio un error al obtener las provincias. Por favor recargue la pagina nuevamente.")}),i.activos_fijos_items().$promise.then(function(t){e.activos_fijos_items=t.data,c()},function(e){alert("Ocurrio un error al obtener los activos fijos. Por favor recargue la pagina nuevamente.")}),i.categoria_certificados().$promise.then(function(t){e.categoriasCertificados=t.data},function(e){alert("Ocurrio un error al obtener las categorias de certificados. Por favor recargue la pagina nuevamente.")}),e.selectedCert=null,e.selectedCatCert=null,e.onCategoriaCertificadoChange=function(){i.certificados({categoria:e.selectedCatCert.id}).$promise.then(function(t){e.certificados=t.data},function(e){alert("Ocurrio un error al obtener los tipos de certificados. Por favor recargue la pagina nuevamente.")})},e.selectedClasificacion=null,e.onClasificacionChange=function(){i.categorias({clasificacion:e.selectedClasificacion.id}).$promise.then(function(t){e.categorias=t.data},function(){alert("Ocurrio un error al obtener las categorias. Por favor recargue la pagina nuevamente.")})},e.selectedProvincia=null,e.onProviniciaChange=function(){i.cantones({provincia:e.selectedProvincia.id}).$promise.then(function(t){e.cantones=t.data},function(){alert("Ocurrio un error al obtener los cantones. Por favor recargue la pagina nuevamente.")})},e.selectedCanton=null,e.onCantonChange=function(){i.parroquias({canton:e.selectedCanton.id}).$promise.then(function(t){e.parroquias=t.data},function(){alert("Ocurrio un error al obtener las parroquias. Por favor recargue la pagina nuevamente.")})};var c=function(){e.est.activos_fijos_items=e.activos_fijos_items.filter(function(t){return angular.isUndefined(t.valor)&&(t.valor=0),parseInt(t.tipo_persona)==parseInt(e.est.tipo_contribuyente)}),e.est.activos_fijos_items.sort(function(e,t){return parseInt(e.orden)-parseInt(t.orden)})};e.onTipoContribuyenteChange=function(){c()},e.onDeclaracionChange=function(){e.est.total_activos_fijos=0,e.est.activos_fijos_items.forEach(function(t){"+"==t.operando?e.est.total_activos_fijos+=t.valor:e.est.total_activos_fijos-=t.valor})},e.onAddCertificado=function(){var t=e.est.certificados.some(function(t){return t.id==e.selectedCert.id});t||(e.est.certificados.push(angular.copy(e.selectedCert)),e.selectedCert=null)},e.onRemoveCertificado=function(t){e.est.certificados=e.est.certificados.filter(function(e){return e.id!=t.id})},e.onGuardar=function(){e.est.$save(function(e){200==e.code?a.path("/home/"+e.data.id):alert("ocurrio un error al guardar, vuelva a intentarlo")},function(e){alert("Ocurrio un error al guardar el establecimiento. Por favor recargue la pagina, e intentelo nuevamente.")})}}function s(e,t){e.isLoggedIn()&&e.logout(),t.path("/")}angular.module("boilerplate").controller("LoginCtrl",e).controller("HomeCtrl",t).controller("EstCtrl",n).controller("UsersCtrl",a).controller("EstablecimientosCtrl",o).controller("RegisterCtrl",r).controller("PassCtrl",i).controller("LogoutCtrl",s),e.$inject=["$scope","$location","Auth"],t.$inject=["$scope","Auth","$routeParams","Establecimiento"],a.$inject=["$scope","Auth","Usuario"],o.$inject=["$scope","$filter","Auth","Establecimiento"],r.$inject=["$scope","Auth","$location","Usuario"],i.$inject=["$scope","Auth","$location"],n.$inject=["$scope","$routeParams","$location","Auth","Establecimiento","Catalogo"],s.$inject=["Auth","$location"]}();